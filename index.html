<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Purpelly 💜</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Inter:wght@300;400;500;600;700&family=Great+Vibes&family=Playfair+Display:wght@400;600;700&display=swap');

        :root {
            --primary-purple: #9d4edd;
            --light-purple: #e0aaff;
            --deep-purple: #7b2cbf;
            --ultra-purple: #5a189a;
            --accent-pink: #ff8cc8;
            --dark-bg: #0a0a1a;
            --glass-bg: rgba(123, 44, 191, 0.15);
            --glass-border: rgba(157, 78, 221, 0.4);
            --text-light: rgba(255, 255, 255, 0.9);
            --text-muted: rgba(255, 255, 255, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            overflow-x: hidden;
            background: var(--dark-bg);
            font-family: 'Inter', sans-serif;
            color: var(--text-light);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Enhanced Cosmic Background with Particles */
        .cosmic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 20%, rgba(157, 78, 221, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(224, 170, 255, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(255, 140, 200, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 30%, #16213e 70%, #0f0f23 100%);
            z-index: -3;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Enhanced Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--ultra-purple) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 1;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .loading-screen.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
        }

        .loading-heart {
            font-size: 5rem;
            color: var(--light-purple);
            animation: loadingPulse 2s infinite ease-in-out;
            margin-bottom: 2rem;
            filter: drop-shadow(0 0 20px var(--primary-purple));
        }

        .loading-text {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: var(--light-purple);
            opacity: 0;
            animation: fadeInUp 1s ease-out 0.5s forwards;
        }

        @keyframes loadingPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Enhanced Header */
        .header {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .title {
            font-family: 'Great Vibes', cursive;
            font-size: clamp(3rem, 10vw, 6rem);
            background: linear-gradient(135deg, #e0aaff 0%, #c77dff 50%, #ff8cc8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            text-shadow: 0 0 30px rgba(224, 170, 255, 0.5);
            z-index: 10;
            animation: titleFloat 6s ease-in-out infinite;
            position: relative;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            font-size: clamp(1.1rem, 3.5vw, 1.8rem);
            margin-bottom: 3rem;
            max-width: 800px;
            z-index: 10;
            font-weight: 300;
            line-height: 1.8;
            color: var(--text-muted);
            opacity: 0;
            animation: fadeInUp 1s ease-out 0.8s forwards;
            font-family: 'Playfair Display', serif;
        }

        /* Enhanced Scroll Indicator */
        .scroll-down {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--light-purple);
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            padding: 20px;
            border: 2px solid var(--glass-border);
            border-radius: 50%;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: bounce 2s infinite;
        }

        .scroll-down:hover {
            transform: translateX(-50%) scale(1.1);
            background: rgba(157, 78, 221, 0.3);
            box-shadow: 0 10px 30px rgba(157, 78, 221, 0.4);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }

        /* Enhanced Gallery */
        .gallery-section {
            padding: 6rem 2rem;
            position: relative;
        }

        .section-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2.5rem, 7vw, 4rem);
            background: linear-gradient(135deg, #e0aaff 0%, #c77dff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-purple), transparent);
            border-radius: 2px;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .gallery-item {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow:
                0 20px 40px rgba(157, 78, 221, 0.2),
                0 10px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            aspect-ratio: 1/1;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            opacity: 0;
            transform: translateY(50px);
            animation: slideInUp 0.8s ease-out forwards;
        }

        .gallery-item:nth-child(2) { animation-delay: 0.2s; }
        .gallery-item:nth-child(3) { animation-delay: 0.4s; }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .gallery-item:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow:
                0 30px 60px rgba(157, 78, 221, 0.3),
                0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .gallery-item.video-item {
            aspect-ratio: 9/16;
        }

        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.6s ease;
        }

        .gallery-item:hover img,
        .gallery-item:hover video {
            transform: scale(1.05);
        }

        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(10, 10, 26, 0.95));
            padding: 1.5rem;
            font-family: 'Dancing Script', cursive;
            font-size: 1.4rem;
            color: var(--light-purple);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        /* Enhanced Video Controls */
        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .custom-video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            backdrop-filter: blur(10px);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 10;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .video-container:hover .custom-video-controls {
            transform: translateY(0);
        }

        .video-control-btn {
            background: rgba(157, 78, 221, 0.8);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .video-control-btn:hover {
            background: var(--primary-purple);
            transform: scale(1.1);
        }

        .video-progress {
            flex-grow: 1;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            margin: 0 15px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .video-progress::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .video-progress-filled {
            height: 100%;
            background: linear-gradient(90deg, var(--light-purple), var(--accent-pink));
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .video-time {
            font-size: 0.9rem;
            color: white;
            white-space: nowrap;
            font-weight: 500;
        }

        /* Enhanced Letter Section */
        .letter-section {
            padding: 6rem 2rem;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
        }

        .letter-content {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 25px;
            padding: 3rem;
            width: 100%;
            box-shadow:
                0 25px 50px rgba(157, 78, 221, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }

        .letter-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--light-purple), transparent);
        }

        .letter-text {
            font-size: 1.1rem;
            line-height: 1.9;
            margin-bottom: 1.8rem;
            font-weight: 400;
            color: var(--text-light);
            font-family: 'Playfair Display', serif;
        }

        .letter-text:first-child {
            font-family: 'Dancing Script', cursive;
            font-size: 1.4rem;
            color: var(--light-purple);
            margin-bottom: 2rem;
        }

        .letter-signature {
            font-family: 'Great Vibes', cursive;
            font-size: 2.2rem;
            background: linear-gradient(135deg, #e0aaff 0%, #ff8cc8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: right;
            margin-top: 3rem;
        }

        /* Enhanced Music Player */
        .music-player {
            position: fixed;
            top: 25px;
            right: 25px;
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 50px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 30px rgba(157, 78, 221, 0.3);
            transition: all 0.3s ease;
        }

        .music-player:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(157, 78, 221, 0.4);
        }

        .music-control {
            color: var(--light-purple);
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
        }

        .music-control:hover {
            color: var(--accent-pink);
            background: rgba(157, 78, 221, 0.2);
            transform: scale(1.1);
        }

        .song-title {
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 150px;
            color: var(--light-purple);
            font-weight: 500;
        }

        /* Enhanced Footer */
        .footer {
            text-align: center;
            padding: 4rem 2rem;
            font-family: 'Dancing Script', cursive;
            font-size: 1.6rem;
            color: var(--light-purple);
            position: relative;
            background: linear-gradient(transparent, rgba(10, 10, 26, 0.9));
        }

        .footer-heart {
            color: var(--accent-pink);
            animation: heartbeat 2s infinite;
            display: inline-block;
            filter: drop-shadow(0 0 10px var(--accent-pink));
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }

        /* Media Fallbacks */
        .media-fallback {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #9d4edd, #e0aaff);
            color: white;
            font-size: 1.5rem;
            text-align: center;
            gap: 1rem;
        }

        .media-fallback i {
            font-size: 3rem;
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .gallery {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .letter-content {
                padding: 2rem;
            }

            .music-player {
                top: 20px;
                right: 20px;
                padding: 0.8rem 1rem;
            }

            .song-title {
                max-width: 100px;
                font-size: 0.9rem;
            }

            .gallery-section,
            .letter-section {
                padding: 4rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .video-control-btn {
                font-size: 1rem;
                padding: 6px 10px;
            }

            .video-time {
                font-size: 0.8rem;
            }

            .custom-video-controls {
                padding: 10px;
                gap: 10px;
            }

            .letter-text {
                font-size: 1rem;
            }

            .title {
                margin-bottom: 1.5rem;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .scroll-down {
                animation: none;
            }
        }

        /* Focus styles for keyboard navigation */
        .video-control-btn:focus,
        .music-control:focus,
        .scroll-down:focus {
            outline: 2px solid var(--light-purple);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-heart">💜</div>
            <div class="loading-text">Loading something special...</div>
        </div>
    </div>

    <!-- Background -->
    <div class="cosmic-bg"></div>
    <div class="stars" id="stars"></div>

    <!-- Demo Audio -->
    <audio id="bgMusic" loop>
        <source src="./media/constellations.mp3" type="audio/wav">
    </audio>

    <!-- Header Section -->
    <section class="header">
        <!-- Music Player -->
        <div class="music-player" id="musicPlayer">
            <i class="fas fa-music music-control" id="playBtn" aria-label="Play music"></i>
            <span class="song-title" id="songTitle">For Purpelly 💜</span>
        </div>

        <h1 class="title">For My Purpelly💜</h1>
        <p class="subtitle">Every moment with you is a treasure more precious than all the stars in the sky</p>

        <div class="scroll-down" id="scrollDown" aria-label="Scroll to gallery">
            <i class="fas fa-chevron-down"></i>
        </div>
    </section>

    <!-- Gallery Section -->
    <section class="gallery-section" id="gallery">
        <h2 class="section-title">Your Beautiful Moments</h2>
        <div class="gallery">
            <div class="gallery-item">
                <picture>
                    <source srcset="./media/IMG-20250615-WA0249.jpg" type="image/jpeg">
                    <div class="media-fallback">
                        <i class="fas fa-camera"></i>
                        <span>Shinny Forehead</span>
                    </div>
                </picture>
                <div class="gallery-caption">Shinny Forehead😂💜</div>
            </div>

            <div class="gallery-item video-item">
                <div class="video-container">
                    <video id="mainVideo" preload="metadata" poster="./media/video-poster.jpg" aria-label="Our special moment video">
                        <source src="./media/VID-20250615-WA0257.mp4" type="video/mp4">
                        <div class="media-fallback">
                            <i class="fas fa-video"></i>
                            <span>Our Video</span>
                        </div>
                    </video>
                    <div class="custom-video-controls">
                        <button class="video-control-btn" id="videoPlayBtn" aria-label="Play video">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="video-control-btn" id="videoMuteBtn" aria-label="Mute video">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <div class="video-progress" id="videoProgress" aria-label="Video progress">
                            <div class="video-progress-filled" id="videoProgressFilled"></div>
                        </div>
                        <span class="video-time" id="videoTime">0:00 / 0:00</span>
                    </div>
                </div>
                <div class="gallery-caption">Our Special Moment</div>
            </div>

            <div class="gallery-item">
                <picture>
                    <source srcset="./media/IMG-20250616-WA0105.jpg" type="image/jpeg">
                    <div class="media-fallback">
                        <i class="fas fa-smile"></i>
                        <span>Your Smile</span>
                    </div>
                </picture>
                <div class="gallery-caption">That Beautiful Smile</div>
            </div>
        </div>
    </section>

    <!-- Love Letter Section -->
    <section class="letter-section">
        <h2 class="section-title">My Heart's Message</h2>
        <div class="letter-content">
            <p class="letter-text">My Dearest Purpelly,</p>
            <p class="letter-text">From the moment our paths crossed, my world has been painted in the most beautiful shades of purple - the color of royalty, magic, and our love.</p>
            <p class="letter-text">Your laughter is my favorite melody, your smile my brightest light. Each day with you is a gift I treasure more than words can express.</p>
            <p class="letter-text">In your eyes, I see galaxies of possibilities, and in your heart, I've found my forever home. You make ordinary moments extraordinary just by being you.</p>
            <p class="letter-text">I promise to be your shelter in storms, your partner in adventures, and your biggest fan in all you do. My heart found its home in yours, and there it will stay for eternity.</p>
            <p class="letter-text">Forever and always yours,</p>
            <p class="letter-signature">Your Devoted Heart</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>Made with <span class="footer-heart">❤️</span> for you, my Purpelly</p>
        <p style="font-size: 1rem; margin-top: 1rem; opacity: 0.7;">You are my universe 🌌</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Create animated stars
            function createStars() {
                const starsContainer = document.getElementById('stars');
                const numberOfStars = 50;

                for (let i = 0; i < numberOfStars; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animationDelay = Math.random() * 3 + 's';
                    star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    starsContainer.appendChild(star);
                }
            }

            createStars();

            // Enhanced loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
            }, 2000);

            // Smooth scroll with enhanced easing
            document.getElementById('scrollDown').addEventListener('click', () => {
                const gallery = document.getElementById('gallery');
                const headerHeight = window.innerHeight;

                window.scrollTo({
                    top: headerHeight - 100,
                    behavior: 'smooth'
                });
            });

            // Enhanced music player
            const bgMusic = document.getElementById('bgMusic');
            const playBtn = document.getElementById('playBtn');
            let musicEnabled = false;

            // Enable music after first user interaction
            document.body.addEventListener('click', function enableMusic() {
                if (!musicEnabled) {
                    bgMusic.volume = 0.2;
                    musicEnabled = true;
                    document.body.removeEventListener('click', enableMusic);
                }
            }, { once: true });

            playBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("Audio play failed:", e));
                    playBtn.classList.remove('fa-music');
                    playBtn.classList.add('fa-pause');
                } else {
                    bgMusic.pause();
                    playBtn.classList.remove('fa-pause');
                    playBtn.classList.add('fa-music');
                }
            });

            // Enhanced video controls
            const video = document.getElementById('mainVideo');
            const videoPlayBtn = document.getElementById('videoPlayBtn');
            const videoMuteBtn = document.getElementById('videoMuteBtn');
            const videoProgress = document.getElementById('videoProgress');
            const videoProgressFilled = document.getElementById('videoProgressFilled');
            const videoTime = document.getElementById('videoTime');

            if (video) {
                // Play/Pause with enhanced feedback
                videoPlayBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (video.paused) {
                        video.play().then(() => {
                            videoPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
                            videoPlayBtn.setAttribute('aria-label', 'Pause video');
                        }).catch(e => console.log("Video play failed:", e));
                    } else {
                        video.pause();
                        videoPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                        videoPlayBtn.setAttribute('aria-label', 'Play video');
                    }
                });

                // Enhanced mute/unmute
                videoMuteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (video.muted) {
                        video.muted = false;
                        videoMuteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                        videoMuteBtn.setAttribute('aria-label', 'Mute video');
                    } else {
                        video.muted = true;
                        videoMuteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                        videoMuteBtn.setAttribute('aria-label', 'Unmute video');
                    }
                });

                // Enhanced progress tracking
                video.addEventListener('timeupdate', () => {
                    if (video.duration) {
                        const percent = (video.currentTime / video.duration) * 100;
                        videoProgressFilled.style.width = `${percent}%`;

                        // Update time display
                        const currentTime = formatTime(video.currentTime);
                        const duration = formatTime(video.duration);
                        videoTime.textContent = `${currentTime} / ${duration}`;
                    }
                });

                // Click to seek with smooth animation
                videoProgress.addEventListener('click', (e) => {
                    const rect = videoProgress.getBoundingClientRect();
                    const pos = (e.clientX - rect.left) / rect.width;
                    video.currentTime = pos * video.duration;
                });

                // Format time as MM:SS
                function formatTime(seconds) {
                    if (isNaN(seconds)) return '0:00';
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
                }

                // Show duration when metadata loads
                video.addEventListener('loadedmetadata', () => {
                    videoTime.textContent = `0:00 / ${formatTime(video.duration)}`;
                });

                // Handle video end
                video.addEventListener('ended', () => {
                    videoPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                    videoPlayBtn.setAttribute('aria-label', 'Play video');
                });
            }

            // Enhanced lazy loading with intersection observer
            if ('IntersectionObserver' in window) {
                const lazyMediaObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const media = entry.target;

                            if (media.tagName === 'PICTURE') {
                                const source = media.querySelector('source');
                                if (source && source.srcset) {
                                    const img = new Image();
                                    img.src = source.srcset;
                                    img.alt = media.parentNode.querySelector('.gallery-caption')?.textContent || 'Gallery image';
                                    img.style.width = '100%';
                                    img.style.height = '100%';
                                    img.style.objectFit = 'cover';
                                    img.style.display = 'block';
                                    img.style.transition = 'transform 0.6s ease';

                                    img.onload = () => {
                                        media.parentNode.replaceChild(img, media);
                                    };

                                    img.onerror = () => {
                                        // Keep fallback if image fails to load
                                        console.log('Image failed to load:', source.srcset);
                                    };
                                }
                            } else if (media.tagName === 'VIDEO') {
                                media.load();
                            }

                            lazyMediaObserver.unobserve(media);
                        }
                    });
                }, {
                    rootMargin: '100px'
                });

                // Observe all pictures and videos
                document.querySelectorAll('picture, video').forEach(media => {
                    lazyMediaObserver.observe(media);
                });

                // Gallery item animation on scroll
                const galleryItemObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.animationPlayState = 'running';
                        }
                    });
                }, {
                    threshold: 0.1
                });

                document.querySelectorAll('.gallery-item').forEach(item => {
                    galleryItemObserver.observe(item);
                });

            } else {
                // Fallback for browsers without IntersectionObserver
                document.querySelectorAll('picture source').forEach(source => {
                    if (source.srcset) {
                        const img = new Image();
                        img.src = source.srcset;
                        img.alt = 'Gallery image';
                        img.style.width = '100%';
                        img.style.height = '100%';
                        img.style.objectFit = 'cover';
                        img.style.display = 'block';

                        img.onload = () => {
                            source.parentNode.parentNode.replaceChild(img, source.parentNode);
                        };
                    }
                });

                document.querySelectorAll('video').forEach(video => {
                    video.load();
                });
            }

            // Add keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown' || e.key === ' ') {
                    e.preventDefault();
                    const gallery = document.getElementById('gallery');
                    gallery.scrollIntoView({ behavior: 'smooth' });
                }
            });

            // Add smooth reveal animations for letter content
            const letterObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const texts = entry.target.querySelectorAll('.letter-text');
                        texts.forEach((text, index) => {
                            setTimeout(() => {
                                text.style.opacity = '1';
                                text.style.transform = 'translateY(0)';
                            }, index * 200);
                        });
                    }
                });
            }, { threshold: 0.3 });

            const letterContent = document.querySelector('.letter-content');
            if (letterContent) {
                // Initially hide letter texts
                letterContent.querySelectorAll('.letter-text').forEach(text => {
                    text.style.opacity = '0';
                    text.style.transform = 'translateY(20px)';
                    text.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                });

                letterObserver.observe(letterContent);
            }

            // Add parallax effect to background
            let ticking = false;

            function updateParallax() {
                const scrolled = window.pageYOffset;
                const parallax = document.querySelector('.cosmic-bg');
                const speed = scrolled * 0.5;

                parallax.style.transform = `translateY(${speed}px)`;
                ticking = false;
            }

            function requestParallax() {
                if (!ticking) {
                    requestAnimationFrame(updateParallax);
                    ticking = true;
                }
            }

            // Only add parallax if user hasn't requested reduced motion
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                window.addEventListener('scroll', requestParallax);
            }

            // Add touch gestures for mobile
            let touchStartY = 0;
            let touchEndY = 0;

            document.addEventListener('touchstart', e => {
                touchStartY = e.changedTouches[0].screenY;
            });

            document.addEventListener('touchend', e => {
                touchEndY = e.changedTouches[0].screenY;
                handleGesture();
            });

            function handleGesture() {
                const swipeThreshold = 50;
                const diff = touchStartY - touchEndY;

                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        // Swipe up - scroll to gallery
                        if (window.pageYOffset < window.innerHeight / 2) {
                            document.getElementById('gallery').scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                }
            }

            // Add error handling for media
            document.querySelectorAll('img, video').forEach(media => {
                media.addEventListener('error', (e) => {
                    console.log(`Media failed to load: ${e.target.src}`);
                    // Fallback is already in place via HTML structure
                });
            });

            // Performance optimization: pause animations when not visible
            const handleVisibilityChange = () => {
                if (document.hidden) {
                    // Pause video if playing
                    if (video && !video.paused) {
                        video.pause();
                    }
                    // Pause background music
                    if (!bgMusic.paused) {
                        bgMusic.pause();
                    }
                }
            };

            document.addEventListener('visibilitychange', handleVisibilityChange);

            // Add resize handler for responsive adjustments
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    // Recalculate any size-dependent elements
                    const musicPlayer = document.querySelector('.music-player');
                    if (window.innerWidth < 480) {
                        musicPlayer.style.transform = 'scale(0.9)';
                    } else {
                        musicPlayer.style.transform = 'scale(1)';
                    }
                }, 150);
            });

            // Initialize any remaining setup
            console.log('💜 Love letter website initialized successfully!');
        });
    </script>
</body>
</html>
